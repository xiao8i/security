# SSL、TSL(SSL存在POODLE漏洞，请使用TSL)在会话层，专为应用层HTTP协议提供加密、认证以及校验。可以看出不能保护TCP协议（因为在TCP的上层），保护TCP、UDP等传输层需要用到IPsec
TCP连接建立后，SSL握手协议：
1）客户端向服务器发送可以接受的交换（DH/RSA），加密（一般DES）和摘要算法（MAC）等（包括sessionid），还有一个随机数1并开始一个新的会话连接；
2）服务器响应客户端选择的交换加密和摘要算法等，还有一个随机数2；然后服务器发送服务器证书，（可选：要求客户端发送证书）
3）客户端根据收到的服务器响应信息，向CA验证服务器证书，并产生一个随机数3（预主秘钥）用服务器的公钥加密后传给服务器；（可选，发送客户端的证书，并对随机数3进行签名，此时完成对客户端的认证）
4）服务器用私钥解得随机数3，随机数1,2,3生成主密钥和MAC秘钥（客户端也生成一样的主密钥和MAC秘钥）。
5）客户端通知服务器切换为加密通信，客户端做好加密通信准备；服务器通知服客户端切换为加密通信，服务器做好加密通信准备；服务器和客户端用主密钥作为对称加密秘钥进行HTTPS通信。
6)  客户端和服务器会互相保密发送把之前所有消息做摘要的MAC值来验证有效。
SSL记录协议：
（1）完整性：利用握手协议所定义的共享的MAC密钥来生成报文的鉴别码（MAC）。
（2）保密性：利用握手协议所定义的对称密钥对SSL净荷（Payload）加密。
https://www.jianshu.com/p/1fc7130eb2c2
https://xz.aliyun.com/t/2531
注意MAC摘要算法广泛应用于对称加密DES，对它也可再用私钥加密但只能起到防抵赖的作用（即普通hash(包括sha256)只能校验数据完整性，MAC可以额外提供认证，签名可以认证加防抵赖）
mac函数可以用hash函数来构造，就叫做hmac，也可以使用对称加密函数来构造。任何加密HASH, 比如MD5、SHA256等，都可以用来实现HMAC算法，其相应的算法称为HMAC-MD5、HMAC-SHA256等。